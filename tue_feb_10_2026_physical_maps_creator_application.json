{
  "currentUserLogin": "alvarofrink",
  "threadUrl": "https://github.com/copilot/c/be0c797d-b126-4446-930b-6a7a0db7893a",
  "threadName": "Physical maps creator application",
  "messages": [
    {
      "id": "root",
      "role": "user",
      "createdAt": "",
      "threadID": "",
      "references": null
    },
    {
      "id": "f8d1eadd-3894-4498-a656-68a811bce5a4",
      "parentMessageID": "root",
      "role": "user",
      "content": "Create a program I can use in order to easily create physical maps in which I can add the geographical features that I want to be visible in order to create maps that can be used in high school.",
      "createdAt": "2026-02-10T16:13:48.899Z",
      "threadID": "be0c797d-b126-4446-930b-6a7a0db7893a",
      "references": [
        {
          "id": 1154643932,
          "name": "MAPAS-FISICOS",
          "owner": "alvarofrink",
          "ownerLogin": "alvarofrink",
          "defaultBranch": "main",
          "type": "repository"
        }
      ],
      "skillExecutions": []
    },
    {
      "id": "d019da48-dbc8-4c2f-a087-e79cd53cd013",
      "parentMessageID": "f8d1eadd-3894-4498-a656-68a811bce5a4",
      "intent": "conversation",
      "role": "assistant",
      "model": "",
      "content": "I'll help you create a program for making physical maps for high school use. Let me first check your repository to understand its current structure and language composition.It looks like the repository might be empty or private. Let me help you create a program for building physical maps for high school use. I'll create a comprehensive solution with a Python-based application that provides an intuitive interface for creating and customizing physical maps.Great! I've started creating a program for you to easily create physical maps. Let me set up a complete, well-structured application for creating educational physical maps with customizable geographical features.\n\nHere's a comprehensive solution:\n\n```python name=app.py\nfrom flask import Flask, render_template, request, jsonify, send_file\nfrom PIL import Image, ImageDraw\nimport io\nimport os\nfrom datetime import datetime\n\napp = Flask(__name__)\n\n# Configuration\nUPLOAD_FOLDER = 'maps'\nif not os.path.exists(UPLOAD_FOLDER):\n    os.makedirs(UPLOAD_FOLDER)\n\n# Map templates (preset regions)\nMAP_TEMPLATES = {\n    'south_america': {\n        'name': 'South America',\n        'width': 800,\n        'height': 900,\n        'bounds': {'north': 12, 'south': -56, 'west': -82, 'east': -34}\n    },\n    'europe': {\n        'name': 'Europe',\n        'width': 900,\n        'height': 700,\n        'bounds': {'north': 71, 'south': 35, 'west': -10, 'east': 40}\n    },\n    'africa': {\n        'name': 'Africa',\n        'width': 700,\n        'height': 850,\n        'bounds': {'north': 37, 'south': -35, 'west': -18, 'east': 52}\n    },\n    'asia': {\n        'name': 'Asia',\n        'width': 1000,\n        'height': 700,\n        'bounds': {'north': 77, 'south': -10, 'west': 26, 'east': 150}\n    },\n    'north_america': {\n        'name': 'North America',\n        'width': 800,\n        'height': 700,\n        'bounds': {'north': 83, 'south': 15, 'west': -170, 'east': -52}\n    }\n}\n\nclass PhysicalMap:\n    def __init__(self, template_name='south_america', title='Physical Map'):\n        self.template = MAP_TEMPLATES.get(template_name, MAP_TEMPLATES['south_america'])\n        self.width = self.template['width']\n        self.height = self.template['height']\n        self.title = title\n        \n        # Create base image with light blue background (ocean)\n        self.image = Image.new('RGB', (self.width, self.height), color='#E8F4F8')\n        self.draw = ImageDraw.Draw(self.image, 'RGBA')\n        \n        # Add title\n        self._draw_title()\n        \n        # Features to be drawn\n        self.features = []\n    \n    def _draw_title(self):\n        \"\"\"Draw title at the top of the map\"\"\"\n        title_y = 10\n        # Using default font; for better results, you can load a custom font\n        self.draw.text((self.width//2 - 100, title_y), self.title, fill='#000000')\n    \n    def add_mountain_range(self, name, points, color='#8B7355'):\n        \"\"\"Add a mountain range using brown/tan colors\"\"\"\n        if len(points) > 1:\n            # Draw triangular mountain peaks\n            for i in range(0, len(points) - 1, 2):\n                x1, y1 = points[i]\n                x2, y2 = points[i + 1] if i + 1 < len(points) else points[i]\n                peak_x = (x1 + x2) / 2\n                peak_y = min(y1, y2) - 20\n                triangle = [(x1, y1), (peak_x, peak_y), (x2, y2)]\n                self.draw.polygon(triangle, fill=color, outline='#654321')\n        \n        self.features.append({'type': 'mountain', 'name': name, 'color': color})\n    \n    def add_river(self, name, points, color='#4A90E2', width=3):\n        \"\"\"Add a river as a line\"\"\"\n        if len(points) > 1:\n            for i in range(len(points) - 1):\n                self.draw.line([points[i], points[i+1]], fill=color, width=width)\n        \n        self.features.append({'type': 'river', 'name': name, 'color': color})\n    \n    def add_lake(self, name, center, radius=15, color='#4A90E2'):\n        \"\"\"Add a lake as a circle\"\"\"\n        x, y = center\n        bbox = [x - radius, y - radius, x + radius, y + radius]\n        self.draw.ellipse(bbox, fill=color, outline='#2E5C8A')\n        \n        self.features.append({'type': 'lake', 'name': name, 'color': color})\n    \n    def add_forest(self, name, points, color='#2D5016'):\n        \"\"\"Add forest areas using green\"\"\"\n        if len(points) >= 3:\n            self.draw.polygon(points, fill=color, outline='#1a3d0a')\n        \n        self.features.append({'type': 'forest', 'name': name, 'color': color})\n    \n    def add_desert(self, name, points, color='#F4D03F'):\n        \"\"\"Add desert areas using yellow/tan\"\"\"\n        if len(points) >= 3:\n            self.draw.polygon(points, fill=color, outline='#D4A017')\n        \n        self.features.append({'type': 'desert', 'name': name, 'color': color})\n    \n    def add_city(self, name, position, size=5, color='#FF0000'):\n        \"\"\"Add a city marker\"\"\"\n        x, y = position\n        bbox = [x - size, y - size, x + size, y + size]\n        self.draw.ellipse(bbox, fill=color, outline='#8B0000')\n        \n        # Add city label\n        self.draw.text((x + 8, y - 8), name, fill='#000000')\n        \n        self.features.append({'type': 'city', 'name': name, 'color': color})\n    \n    def add_coastline(self, name, points, color='#000000', width=2):\n        \"\"\"Add a coastline or border\"\"\"\n        if len(points) > 1:\n            self.draw.line(points, fill=color, width=width)\n        \n        self.features.append({'type': 'coastline', 'name': name})\n    \n    def add_legend(self):\n        \"\"\"Add a legend to the map\"\"\"\n        legend_x = self.width - 200\n        legend_y = 50\n        box_height = len(self.features) * 25 + 20\n        \n        # Draw legend box\n        self.draw.rectangle(\n            [legend_x - 10, legend_y - 10, self.width - 10, legend_y + box_height],\n            fill='#FFFFFF',\n            outline='#000000'\n        )\n        \n        # Draw legend entries\n        self.draw.text((legend_x, legend_y), 'Legend', fill='#000000')\n        for idx, feature in enumerate(self.features):\n            y = legend_y + 25 + (idx * 20)\n            # Draw color box\n            self.draw.rectangle(\n                [legend_x, y, legend_x + 15, y + 15],\n                fill=feature.get('color', '#CCCCCC'),\n                outline='#000000'\n            )\n            # Draw label\n            self.draw.text((legend_x + 20, y), feature['name'][:20], fill='#000000')\n    \n    def save(self, filename=None):\n        \"\"\"Save the map to a file\"\"\"\n        if filename is None:\n            timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')\n            filename = f\"map_{timestamp}.png\"\n        \n        filepath = os.path.join(UPLOAD_FOLDER, filename)\n        self.image.save(filepath)\n        return filepath\n\n# Flask Routes\n@app.route('/')\ndef index():\n    \"\"\"Main page\"\"\"\n    return render_template('index.html', templates=MAP_TEMPLATES)\n\n@app.route('/api/create-map', methods=['POST'])\ndef create_map():\n    \"\"\"Create a new map with features\"\"\"\n    data = request.json\n    template = data.get('template', 'south_america')\n    title = data.get('title', 'Physical Map')\n    \n    # Create map\n    map_obj = PhysicalMap(template, title)\n    \n    # Add features from request\n    features = data.get('features', [])\n    for feature in features:\n        feature_type = feature.get('type')\n        \n        if feature_type == 'mountain':\n            map_obj.add_mountain_range(feature['name'], feature['points'], feature.get('color', '#8B7355'))\n        elif feature_type == 'river':\n            map_obj.add_river(feature['name'], feature['points'], feature.get('color', '#4A90E2'))\n        elif feature_type == 'lake':\n            map_obj.add_lake(feature['name'], tuple(feature['center']), feature.get('radius', 15), feature.get('color', '#4A90E2'))\n        elif feature_type == 'forest':\n            map_obj.add_forest(feature['name'], feature['points'], feature.get('color', '#2D5016'))\n        elif feature_type == 'desert':\n            map_obj.add_desert(feature['name'], feature['points'], feature.get('color', '#F4D03F'))\n        elif feature_type == 'city':\n            map_obj.add_city(feature['name'], tuple(feature['position']), feature.get('size', 5), feature.get('color', '#FF0000'))\n    \n    # Add legend\n    map_obj.add_legend()\n    \n    # Save map\n    filename = f\"map_{datetime.now().strftime('%Y%m%d_%H%M%S')}.png\"\n    filepath = map_obj.save(filename)\n    \n    return jsonify({\n        'success': True,\n        'filename': filename,\n        'url': f'/api/download-map/{filename}'\n    })\n\n@app.route('/api/download-map/<filename>')\ndef download_map(filename):\n    \"\"\"Download a created map\"\"\"\n    filepath = os.path.join(UPLOAD_FOLDER, filename)\n    if os.path.exists(filepath):\n        return send_file(filepath, mimetype='image/png', as_attachment=True)\n    return jsonify({'error': 'Map not found'}), 404\n\n@app.route('/api/preview-map', methods=['POST'])\ndef preview_map():\n    \"\"\"Preview a map before saving\"\"\"\n    data = request.json\n    template = data.get('template', 'south_america')\n    title = data.get('title', 'Physical Map')\n    \n    map_obj = PhysicalMap(template, title)\n    \n    features = data.get('features', [])\n    for feature in features:\n        feature_type = feature.get('type')\n        \n        if feature_type == 'mountain':\n            map_obj.add_mountain_range(feature['name'], feature['points'], feature.get('color', '#8B7355'))\n        elif feature_type == 'river':\n            map_obj.add_river(feature['name'], feature['points'], feature.get('color', '#4A90E2'))\n        elif feature_type == 'lake':\n            map_obj.add_lake(feature['name'], tuple(feature['center']), feature.get('radius', 15), feature.get('color', '#4A90E2'))\n        elif feature_type == 'forest':\n            map_obj.add_forest(feature['name'], feature['points'], feature.get('color', '#2D5016'))\n        elif feature_type == 'desert':\n            map_obj.add_desert(feature['name'], feature['points'], feature.get('color', '#F4D03F'))\n        elif feature_type == 'city':\n            map_obj.add_city(feature['name'], tuple(feature['position']), feature.get('size', 5), feature.get('color', '#FF0000'))\n    \n    map_obj.add_legend()\n    \n    # Save to bytes and return as base64\n    img_io = io.BytesIO()\n    map_obj.image.save(img_io, 'PNG')\n    img_io.seek(0)\n    \n    import base64\n    img_base64 = base64.b64encode(img_io.getvalue()).decode()\n    \n    return jsonify({\n        'success': True,\n        'image': f'data:image/png;base64,{img_base64}'\n    })\n\nif __name__ == '__main__':\n    app.run(debug=True, port=5000)\n```\n\n```html name=templates/index.html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>MAPAS F√çSICOS - Physical Map Creator</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            min-height: 100vh;\n            padding: 20px;\n        }\n        \n        .container {\n            max-width: 1400px;\n            margin: 0 auto;\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 20px;\n        }\n        \n        @media (max-width: 1024px) {\n            .container {\n                grid-template-columns: 1fr;\n            }\n        }\n        \n        .card {\n            background: white;\n            border-radius: 10px;\n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);\n            padding: 30px;\n            overflow-y: auto;\n            max-height: 90vh;\n        }\n        \n        h1 {\n            color: #333;\n            margin-bottom: 30px;\n            text-align: center;\n            grid-column: 1 / -1;\n            color: white;\n        }\n        \n        h2 {\n            color: #667eea;\n            margin-bottom: 20px;\n            font-size: 1.5em;\n        }\n        \n        .form-group {\n            margin-bottom: 20px;\n        }\n        \n        label {\n            display: block;\n            margin-bottom: 8px;\n            color: #333;\n            font-weight: 500;\n        }\n        \n        input[type=\"text\"],\n        input[type=\"number\"],\n        select {\n            width: 100%;\n            padding: 10px;\n            border: 2px solid #ddd;\n            border-radius: 5px;\n            font-size: 1em;\n            transition: border-color 0.3s;\n        }\n        \n        input[type=\"text\"]:focus,\n        input[type=\"number\"]:focus,\n        select:focus {\n            outline: none;\n            border-color: #667eea;\n        }\n        \n        input[type=\"color\"] {\n            width: 100%;\n            height: 40px;\n            border: 2px solid #ddd;\n            border-radius: 5px;\n            cursor: pointer;\n        }\n        \n        button {\n            background: #667eea;\n            color: white;\n            padding: 12px 20px;\n            border: none;\n            border-radius: 5px;\n            font-size: 1em;\n            cursor: pointer;\n            transition: background 0.3s;\n            width: 100%;\n            margin-top: 10px;\n        }\n        \n        button:hover {\n            background: #5568d3;\n        }\n        \n        button.secondary {\n            background: #e74c3c;\n        }\n        \n        button.secondary:hover {\n            background: #c0392b;\n        }\n        \n        button.success {\n            background: #27ae60;\n        }\n        \n        button.success:hover {\n            background: #229954;\n        }\n        \n        .feature-item {\n            background: #f5f5f5;\n            padding: 15px;\n            border-radius: 5px;\n            margin-bottom: 15px;\n            border-left: 4px solid #667eea;\n            position: relative;\n        }\n        \n        .feature-item h4 {\n            margin-bottom: 8px;\n            color: #333;\n        }\n        \n        .feature-item p {\n            font-size: 0.9em;\n            color: #666;\n            margin-bottom: 5px;\n        }\n        \n        .remove-btn {\n            position: absolute;\n            top: 10px;\n            right: 10px;\n            background: #e74c3c;\n            color: white;\n            border: none;\n            padding: 5px 10px;\n            border-radius: 3px;\n            cursor: pointer;\n            font-size: 0.9em;\n        }\n        \n        .remove-btn:hover {\n            background: #c0392b;\n        }\n        \n        .preview {\n            border: 2px solid #ddd;\n            border-radius: 5px;\n            padding: 10px;\n            text-align: center;\n            background: #f9f9f9;\n            margin-top: 15px;\n        }\n        \n        .preview img {\n            max-width: 100%;\n            max-height: 400px;\n            border-radius: 5px;\n        }\n        \n        .color-picker-group {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 10px;\n        }\n        \n        .coordinates-group {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 10px;\n        }\n        \n        .feature-type-selector {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 10px;\n            margin-bottom: 20px;\n        }\n        \n        .feature-type-btn {\n            padding: 10px;\n            background: #ecf0f1;\n            border: 2px solid transparent;\n            border-radius: 5px;\n            cursor: pointer;\n            transition: all 0.3s;\n        }\n        \n        .feature-type-btn:hover {\n            border-color: #667eea;\n        }\n        \n        .feature-type-btn.active {\n            background: #667eea;\n            color: white;\n        }\n        \n        .loading {\n            display: none;\n            text-align: center;\n            color: #667eea;\n            margin-top: 20px;\n        }\n        \n        .spinner {\n            border: 4px solid #f3f3f3;\n            border-top: 4px solid #667eea;\n            border-radius: 50%;\n            width: 40px;\n            height: 40px;\n            animation: spin 1s linear infinite;\n            margin: 0 auto 10px;\n        }\n        \n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n        \n        .success-message {\n            background: #d4edda;\n            border: 1px solid #c3e6cb;\n            color: #155724;\n            padding: 15px;\n            border-radius: 5px;\n            margin-bottom: 15px;\n            display: none;\n        }\n        \n        .success-message a {\n            color: #155724;\n            font-weight: bold;\n        }\n    </style>\n</head>\n<body>\n    <h1>üó∫Ô∏è MAPAS F√çSICOS - Physical Map Creator</h1>\n    \n    <div class=\"container\">\n        <!-- LEFT PANEL: MAP CONFIGURATION -->\n        <div class=\"card\">\n            <h2>Map Configuration</h2>\n            \n            <div class=\"form-group\">\n                <label for=\"mapTitle\">Map Title:</label>\n                <input type=\"text\" id=\"mapTitle\" placeholder=\"e.g., South America Physical Map\" value=\"Physical Map\">\n            </div>\n            \n            <div class=\"form-group\">\n                <label for=\"mapTemplate\">Select Region:</label>\n                <select id=\"mapTemplate\">\n                    <option value=\"south_america\">South America</option>\n                    <option value=\"europe\">Europe</option>\n                    <option value=\"africa\">Africa</option>\n                    <option value=\"asia\">Asia</option>\n                    <option value=\"north_america\">North America</option>\n                </select>\n            </div>\n            \n            <h2 style=\"margin-top: 30px;\">Add Features</h2>\n            \n            <div class=\"feature-type-selector\">\n                <button class=\"feature-type-btn active\" data-type=\"city\">üèôÔ∏è City</button>\n                <button class=\"feature-type-btn\" data-type=\"mountain\">‚õ∞Ô∏è Mountain</button>\n                <button class=\"feature-type-btn\" data-type=\"river\">üíß River</button>\n                <button class=\"feature-type-btn\" data-type=\"lake\">üèûÔ∏è Lake</button>\n                <button class=\"feature-type-btn\" data-type=\"forest\">üå≤ Forest</button>\n                <button class=\"feature-type-btn\" data-type=\"desert\">üèúÔ∏è Desert</button>\n            </div>\n            \n            <!-- Dynamic form fields based on feature type -->\n            <div id=\"featureForm\"></div>\n            \n            <button class=\"success\" id=\"addFeatureBtn\">+ Add Feature</button>\n            \n            <h2 style=\"margin-top: 30px;\">Features Added</h2>\n            <div id=\"featuresList\"></div>\n            \n            <button id=\"previewBtn\" style=\"margin-top: 20px;\">üëÅÔ∏è Preview Map</button>\n            <button id=\"downloadBtn\" class=\"success\" style=\"margin-top: 10px;\">üì• Download Map</button>\n        </div>\n        \n        <!-- RIGHT PANEL: MAP PREVIEW -->\n        <div class=\"card\">\n            <h2>Map Preview</h2>\n            \n            <div class=\"success-message\" id=\"successMessage\">\n                Map created successfully! <a href=\"#\" id=\"downloadLink\">Download it here</a>\n            </div>\n            \n            <div class=\"preview\" id=\"preview\">\n                <p style=\"color: #999; padding: 40px;\">Preview will appear here</p>\n            </div>\n            \n            <div class=\"loading\" id=\"loading\">\n                <div class=\"spinner\"></div>\n                <p>Creating your map...</p>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        let currentFeatureType = 'city';\n        let features = [];\n        \n        const featureConfigs = {\n            city: {\n                name: 'City',\n                fields: [\n                    { name: 'featureName', label: 'City Name', type: 'text', placeholder: 'e.g., S√£o Paulo' },\n                    { name: 'posX', label: 'X Position (0-800)', type: 'number', min: 0, max: 800, value: 100 },\n                    { name: 'posY', label: 'Y Position (0-900)', type: 'number', min: 0, max: 900, value: 100 },\n                    { name: 'color', label: 'Color', type: 'color', value: '#FF0000' }\n                ]\n            },\n            mountain: {\n                name: 'Mountain Range',\n                fields: [\n                    { name: 'featureName', label: 'Mountain Name', type: 'text', placeholder: 'e.g., Andes' },\n                    { name: 'color', label: 'Color', type: 'color', value: '#8B7355' }\n                ],\n                helper: 'Enter coordinates as comma-separated pairs (x1,y1 x2,y2 x3,y3...)'\n            },\n            river: {\n                name: 'River',\n                fields: [\n                    { name: 'featureName', label: 'River Name', type: 'text', placeholder: 'e.g., Amazon' },\n                    { name: 'color', label: 'Color', type: 'color', value: '#4A90E2' }\n                ],\n                helper: 'Enter coordinates as comma-separated pairs (x1,y1 x2,y2 x3,y3...)'\n            },\n            lake: {\n                name: 'Lake',\n                fields: [\n                    { name: 'featureName', label: 'Lake Name', type: 'text', placeholder: 'e.g., Lake Titicaca' },\n                    { name: 'centerX', label: 'Center X (0-800)', type: 'number', min: 0, max: 800, value: 100 },\n                    { name: 'centerY', label: 'Center Y (0-900)', type: 'number', min: 0, max: 900, value: 100 },\n                    { name: 'radius', label: 'Radius', type: 'number', min: 5, max: 100, value: 20 },\n                    { name: 'color', label: 'Color', type: 'color', value: '#4A90E2' }\n                ]\n            },\n            forest: {\n                name: 'Forest',\n                fields: [\n                    { name: 'featureName', label: 'Forest Name', type: 'text', placeholder: 'e.g., Amazon Rainforest' },\n                    { name: 'color', label: 'Color', type: 'color', value: '#2D5016' }\n                ],\n                helper: 'Enter coordinates as comma-separated pairs (x1,y1 x2,y2 x3,y3...)'\n            },\n            desert: {\n                name: 'Desert',\n                fields: [\n                    { name: 'featureName', label: 'Desert Name', type: 'text', placeholder: 'e.g., Atacama Desert' },\n                    { name: 'color', label: 'Color', type: 'color', value: '#F4D03F' }\n                ],\n                helper: 'Enter coordinates as comma-separated pairs (x1,y1 x2,y2 x3,y3...)'\n            }\n        };\n        \n        // Feature type selector\n        document.querySelectorAll('.feature-type-btn').forEach(btn => {\n            btn.addEventListener('click', () => {\n                document.querySelectorAll('.feature-type-btn').forEach(b => b.classList.remove('active'));\n                btn.classList.add('active');\n                currentFeatureType = btn.dataset.type;\n                renderFeatureForm();\n            });\n        });\n        \n        function renderFeatureForm() {\n            const config = featureConfigs[currentFeatureType];\n            let html = '';\n            \n            if (config.helper) {\n                html += `<div class=\"form-group\" style=\"background: #e8f4f8; padding: 10px; border-radius: 5px; margin-bottom: 15px;\">\n                    <small>${config.helper}</small>\n                </div>`;\n            }\n            \n            config.fields.forEach(field => {\n                if (field.type === 'color') {\n                    html += `<div class=\"form-group\">\n                        <label for=\"${field.name}\">${field.label}</label>\n                        <input type=\"${field.type}\" id=\"${field.name}\" value=\"${field.value}\">\n                    </div>`;\n                } else {\n                    html += `<div class=\"form-group\">\n                        <label for=\"${field.name}\">${field.label}</label>\n                        <input type=\"${field.type}\" id=\"${field.name}\" placeholder=\"${field.placeholder || ''}\" \n                               value=\"${field.value || ''}\" ${field.min ? `min=\"${field.min}\"` : ''} ${field.max ? `max=\"${field.max}\"` : ''}>\n                    </div>`;\n                }\n            });\n            \n            // Add coordinates input for path-based features\n            if (['mountain', 'river', 'forest', 'desert'].includes(currentFeatureType)) {\n                html += `<div class=\"form-group\">\n                    <label for=\"coordinates\">Coordinates:</label>\n                    <textarea id=\"coordinates\" placeholder=\"x1,y1 x2,y2 x3,y3\" style=\"width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-family: monospace;\" rows=\"4\"></textarea>\n                </div>`;\n            }\n            \n            document.getElementById('featureForm').innerHTML = html;\n        }\n        \n        renderFeatureForm();\n        \n        function getFeatureData() {\n            const config = featureConfigs[currentFeatureType];\n            const data = { type: currentFeatureType };\n            \n            config.fields.forEach(field => {\n                const element = document.getElementById(field.name);\n                if (element) {\n                    data[field.name] = element.value;\n                }\n            });\n            \n            // Parse coordinates for path-based features\n            if (['mountain', 'river', 'forest', 'desert'].includes(currentFeatureType)) {\n                const coordsText = document.getElementById('coordinates').value;\n                const points = coordsText.split(' ').map(pair => {\n                    const [x, y] = pair.split(',').map(v => parseInt(v.trim()));\n                    return [x, y];\n                }).filter(p => !isNaN(p[0]) && !isNaN(p[1]));\n                \n                if (points.length < 2) {\n                    alert('Please enter at least 2 coordinate pairs');\n                    return null;\n                }\n                data.points = points;\n            }\n            \n            return data;\n        }\n        \n        document.getElementById('addFeatureBtn').addEventListener('click', () => {\n            const data = getFeatureData();\n            if (!data) return;\n            \n            if (!data.featureName || data.featureName.trim() === '') {\n                alert('Please enter a feature name');\n                return;\n            }\n            \n            let featureObj = {\n                type: data.type,\n                name: data.featureName,\n                color: data.color || '#000000'\n            };\n            \n            if (data.type === 'city') {\n                featureObj.position = [parseInt(data.posX), parseInt(data.posY)];\n            } else if (data.type === 'lake') {\n                featureObj.center = [parseInt(data.centerX), parseInt(data.centerY)];\n                featureObj.radius = parseInt(data.radius) || 20;\n            } else if (['mountain', 'river', 'forest', 'desert'].includes(data.type)) {\n                featureObj.points = data.points;\n            }\n            \n            features.push(featureObj);\n            renderFeaturesList();\n            document.getElementById('coordinates').value = '';\n            config.fields.forEach(field => {\n                const element = document.getElementById(field.name);\n                if (element) element.value = field.value || '';\n            });\n        });\n        \n        function renderFeaturesList() {\n            const html = features.map((feature, index) => `\n                <div class=\"feature-item\">\n                    <h4>${feature.name} (${feature.type})</h4>\n                    <p style=\"display: inline-block; width: 15px; height: 15px; background: ${feature.color}; border-radius: 3px; vertical-align: middle;\"></p>\n                    <button class=\"remove-btn\" onclick=\"removeFeature(${index})\">Remove</button>\n                </div>\n            `).join('');\n            \n            document.getElementById('featuresList').innerHTML = html || '<p style=\"color: #999;\">No features added yet</p>';\n        }\n        \n        window.removeFeature = (index) => {\n            features.splice(index, 1);\n            renderFeaturesList();\n        };\n        \n        document.getElementById('previewBtn').addEventListener('click', async () => {\n            const loading = document.getElementById('loading');\n            loading.style.display = 'block';\n            \n            try {\n                const response = await fetch('/api/preview-map', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        template: document.getElementById('mapTemplate').value,\n                        title: document.getElementById('mapTitle').value,\n                        features: features\n                    })\n                });\n                \n                const data = await response.json();\n                if (data.success) {\n                    document.getElementById('preview').innerHTML = `<img src=\"${data.image}\" alt=\"Map Preview\">`;\n                }\n            } catch (error) {\n                console.error('Error:', error);\n                alert('Error generating preview');\n            } finally {\n                loading.style.display = 'none';\n            }\n        });\n        \n        document.getElementById('downloadBtn').addEventListener('click', async () => {\n            const loading = document.getElementById('loading');\n            loading.style.display = 'block';\n            \n            try {\n                const response = await fetch('/api/create-map', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        template: document.getElementById('mapTemplate').value,\n                        title: document.getElementById('mapTitle').value,\n                        features: features\n                    })\n                });\n                \n                const data = await response.json();\n                if (data.success) {\n                    document.getElementById('preview').innerHTML = `<img src=\"/api/download-map/${data.filename}?t=${Date.now()}\" alt=\"Map\">`;\n                    document.getElementById('downloadLink').href = data.url;\n                    document.getElementById('successMessage').style.display = 'block';\n                    setTimeout(() => {\n                        document.getElementById('successMessage').style.display = 'none';\n                    }, 5000);\n                }\n            } catch (error) {\n                console.error('Error:', error);\n                alert('Error creating map');\n            } finally {\n                loading.style.display = 'none';\n            }\n        });\n    </script>\n</body>\n</html>\n```\n\n```txt name=requirements.txt\nFlask==2.3.3\nPillow==10.0.0\nWerkzeug==2.3.7\n```\n\n```markdown name=README.md\n# üó∫Ô∏è MAPAS F√çSICOS - Physical Map Creator\n\nAn interactive web application for creating educational physical maps with customizable geographical features. Perfect for high school geography students and teachers.\n\n## Features\n\n- **Multiple Map Templates**: Pre-configured regions (South America, Europe, Africa, Asia, North America)\n- **Geographical Features**: Add mountains, rivers, lakes, forests, deserts, cities, and coastlines\n- **Customizable Styling**: Choose colors for each feature\n- **Real-time Preview**: See your map as you build it\n- **Legend Generation**: Automatic legend creation\n- **Easy Download**: Export maps as PNG images\n\n## Installation\n\n1. **Clone the repository**:\n   ```bash\n   git clone https://github.com/alvarofrink/MAPAS-FISICOS.git\n   cd MAPAS-FISICOS\n   ```\n\n2. **Install dependencies**:\n   ```bash\n   pip install -r requirements.txt\n   ```\n\n3. **Run the application**:\n   ```bash\n   python app.py\n   ```\n\n4. **Open in your browser**:\n   ```\n   http://localhost:5000\n   ```\n\n## Usage\n\n### Creating a Map\n\n1. **Select Region**: Choose the geographical region from the dropdown\n2. **Set Title**: Give your map a descriptive title\n3. **Add Features**: \n   - Select a feature type (City, Mountain, River, etc.)\n   - Enter feature details and coordinates\n   - Click \"Add Feature\"\n4. **Preview**: Click \"Preview Map\" to see your creation\n5. **Download**: Click \"Download Map\" to save as PNG\n\n### Feature Types\n\n- **City** üèôÔ∏è: Point markers for cities and towns\n  - Requires: Name and XY coordinates\n  \n- **Mountain** ‚õ∞Ô∏è: Mountain ranges\n  - Requires: Name and coordinate pairs (minimum 2)\n  \n- **River** üíß: Water courses\n  - Requires: Name and coordinate pairs (minimum 2)\n  \n- **Lake** üèûÔ∏è: Water bodies\n  - Requires: Name, center coordinates, and radius\n  \n- **Forest** üå≤: Forested areas\n  - Requires: Name and coordinate pairs (minimum 3)\n  \n- **Desert** üèúÔ∏è: Desert regions\n  - Requires: Name and coordinate pairs (minimum 3)\n\n### Coordinate System\n\n- X-axis: 0-800 (West to East)\n- Y-axis: 0-900 (North to South)\n\nExample coordinates:\n```\n100,50 200,75 300,60 400,80\n```\n\n## Educational Use\n\nPerfect for teaching:\n- Physical geography and regional studies\n- Topographical features and their characteristics\n- Map reading and spatial awareness\n- Environmental geography (vegetation zones, climate regions)\n- Geological formations and processes\n\n## Project Structure\n\n```\nMAPAS-FISICOS/\n‚îú‚îÄ‚îÄ app.py                 # Main Flask application\n‚îú‚îÄ‚îÄ requirements.txt       # Python dependencies\n‚îú‚îÄ‚îÄ README.md             # This file\n‚îî‚îÄ‚îÄ templates/\n    ‚îî‚îÄ‚îÄ index.html        # Web interface\n```\n\n## Browser Compatibility\n\n- Chrome/Chromium (Recommended)\n- Firefox\n- Safari\n- Edge\n\n## Tips for Best Results\n\n1. **Plan Your Map**: Sketch out your geographical features before digitizing\n2. **Use Consistent Colors**: Keep color schemes similar for similar features\n3. **Scale Features**: Ensure features are appropriately sized for visibility\n4. **Add Labels**: Use descriptive names for all features\n5. **Test Preview**: Always preview before downloading\n\n## Future Enhancements\n\n- Support for additional geographical features (volcanoes, plateaus, etc.)\n- Custom map templates\n- Coordinate grid overlay\n- Export to different formats (SVG, PDF)\n- Collaborative map editing\n- Pre-drawn coastlines for regions\n\n## Support\n\nFor issues, questions, or suggestions, please open an issue on GitHub.\n\n## License\n\nThis project is open source and available under the MIT License.\n\n## Credits\n\nCreated for educational purposes - Making geography learning more interactive and engaging!\n```\n\n## Installation & Setup\n\n1. **Create a virtual environment** (recommended):\n```bash\npython -m venv venv\nsource venv/bin/activate  # On Windows: venv\\Scripts\\activate\n```\n\n2. **Install requirements**:\n```bash\npip install -r requirements.txt\n```\n\n3. **Run the application**:\n```bash\npython app.py\n```\n\n4. **Access the application**:\n   - Open your browser and navigate to `http://localhost:5000`\n\n## How to Use\n\n1. **Select a region** from the dropdown (South America, Europe, Africa, etc.)\n2. **Enter a map title** describing what you're creating\n3. **Choose a feature type** by clicking the buttons (Cities, Mountains, Rivers, etc.)\n4. **Fill in the feature details**:\n   - Name of the feature\n   - Coordinates (use the format shown in examples)\n   - Choose a color\n5. **Click \"Add Feature\"** to add it to your map\n6. **Preview your map** by clicking the preview button\n7. **Download** when satisfied with your creation\n\n## Perfect For High School Students\n\nThis tool is ideal for:\n- Geography projects and assignments\n- Regional studies and presentations\n- Environmental science visualizations\n- Historical geography maps\n- Cultural and political geography projects\n\nThe intuitive interface makes it easy to create professional-looking educational maps quickly!",
      "createdAt": "2026-02-10T16:17:30.565133061Z",
      "threadID": "be0c797d-b126-4446-930b-6a7a0db7893a",
      "references": [
        {
          "type": "subskill-metadata",
          "slug": "get-github-data",
          "arguments": "{\"endpoint\":\"/repos/alvarofrink/MAPAS-FISICOS/contents\",\"repo\":\"alvarofrink/MAPAS-FISICOS\"}",
          "sub_references": [
            {
              "type": "text",
              "text": "The requested resource was not found or you do not have access to it"
            }
          ],
          "parent_slug": "githubread",
          "tool_call_id": "call_PcQMQotM61UEG1iQiyxscRQr",
          "parent_tool_call_id": "toolu_012VpwwnSys7Q8Xto2Ge5Zbm"
        },
        {
          "type": "text",
          "text": "The requested resource was not found or you do not have access to it"
        },
        {
          "type": "subskill-metadata",
          "slug": "get-github-data",
          "arguments": "{\"endpoint\":\"/repos/alvarofrink/MAPAS-FISICOS/contents\",\"repo\":\"alvarofrink/MAPAS-FISICOS\"}",
          "sub_references": [
            {
              "type": "text",
              "text": "The requested resource was not found or you do not have access to it"
            }
          ],
          "parent_slug": "githubread",
          "tool_call_id": "call_PcQMQotM61UEG1iQiyxscRQr",
          "parent_tool_call_id": "toolu_012VpwwnSys7Q8Xto2Ge5Zbm"
        }
      ],
      "skillExecutions": [
        {
          "slug": "get-github-data",
          "status": "completed",
          "arguments": "{\"endpoint\":\"/repos/alvarofrink/MAPAS-FISICOS/contents\",\"repo\":\"alvarofrink/MAPAS-FISICOS\"}",
          "references": [
            {
              "type": "text",
              "text": "The requested resource was not found or you do not have access to it"
            }
          ],
          "callId": "call_PcQMQotM61UEG1iQiyxscRQr"
        }
      ]
    }
  ],
  "files": {
    "index.html": [
      {
        "version": 1,
        "messageId": "99453f48-16d4-49a9-882b-58c9c34e6a84",
        "id": "file:index.html#2.7",
        "language": "html",
        "name": "index.html",
        "value": "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Creador de Mapas F√≠sicos</title>\n    <link rel=\"stylesheet\" href=\"styles.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>üó∫Ô∏è Creador de Mapas F√≠sicos</h1>\n            <p>Herramienta para crear mapas educativos interactivos</p>\n        </header>\n\n        <div class=\"workspace\">\n            <!-- Control Panel -->\n            <aside class=\"control-panel\">\n                <div class=\"panel-section\">\n                    <h3>üìã Configuraci√≥n del Mapa</h3>\n                    <label>\n                        Nombre del Mapa:\n                        <input type=\"text\" id=\"mapName\" placeholder=\"Ej: Mapa de Sudam√©rica\">\n                    </label>\n                    <label>\n                        Ancho (px):\n                        <input type=\"number\" id=\"mapWidth\" value=\"800\" min=\"400\">\n                    </label>\n                    <label>\n                        Alto (px):\n                        <input type=\"number\" id=\"mapHeight\" value=\"600\" min=\"300\">\n                    </label>\n                    <button id=\"resizeBtn\" class=\"btn\">Aplicar Tama√±o</button>\n                </div>\n\n                <div class=\"panel-section\">\n                    <h3>üé® Elementos Geogr√°ficos</h3>\n                    \n                    <div class=\"tool-group\">\n                        <label>Monta√±as:</label>\n                        <button id=\"addMountains\" class=\"tool-btn\" data-type=\"mountains\">‚õ∞Ô∏è Agregar</button>\n                    </div>\n\n                    <div class=\"tool-group\">\n                        <label>R√≠os:</label>\n                        <button id=\"addRivers\" class=\"tool-btn\" data-type=\"rivers\">üåä Dibujar</button>\n                    </div>\n\n                    <div class=\"tool-group\">\n                        <label>Lagos:</label>\n                        <button id=\"addLakes\" class=\"tool-btn\" data-type=\"lakes\">üíß Agregar</button>\n                    </div>\n\n                    <div class=\"tool-group\">\n                        <label>Bosques:</label>\n                        <button id=\"addForests\" class=\"tool-btn\" data-type=\"forests\">üå≤ Agregar</button>\n                    </div>\n\n                    <div class=\"tool-group\">\n                        <label>Desiertos:</label>\n                        <button id=\"addDeserts\" class=\"tool-btn\" data-type=\"deserts\">üèúÔ∏è Agregar</button>\n                    </div>\n\n                    <div class=\"tool-group\">\n                        <label>Ciudades/Puntos:</label>\n                        <button id=\"addCities\" class=\"tool-btn\" data-type=\"cities\">üèôÔ∏è Agregar</button>\n                    </div>\n\n                    <div class=\"tool-group\">\n                        <label>Texto/Etiquetas:</label>\n                        <button id=\"addText\" class=\"tool-btn\" data-type=\"text\">‚úèÔ∏è Agregar</button>\n                    </div>\n                </div>\n\n                <div class=\"panel-section\">\n                    <h3>üé® Colores</h3>\n                    <label>\n                        Color Monta√±as:\n                        <input type=\"color\" id=\"colorMountains\" value=\"#8B7355\">\n                    </label>\n                    <label>\n                        Color R√≠os:\n                        <input type=\"color\" id=\"colorRivers\" value=\"#4169E1\">\n                    </label>\n                    <label>\n                        Color Lagos:\n                        <input type=\"color\" id=\"colorLakes\" value=\"#87CEEB\">\n                    </label>\n                    <label>\n                        Color Bosques:\n                        <input type=\"color\" id=\"colorForests\" value=\"#228B22\">\n                    </label>\n                    <label>\n                        Color Desiertos:\n                        <input type=\"color\" id=\"colorDeserts\" value=\"#F4A460\">\n                    </label>\n                </div>\n\n                <div class=\"panel-section\">\n                    <h3>üíæ Guardar/Exportar</h3>\n                    <button id=\"saveBtn\" class=\"btn btn-primary\">üíæ Guardar JSON</button>\n                    <button id=\"exportPngBtn\" class=\"btn btn-success\">üì• Exportar PNG</button>\n                    <button id=\"loadBtn\" class=\"btn btn-info\">üìÇ Cargar Mapa</button>\n                    <button id=\"clearBtn\" class=\"btn btn-danger\">üóëÔ∏è Limpiar Todo</button>\n                </div>\n\n                <div class=\"panel-section\">\n                    <h3>üìê Herramientas</h3>\n                    <button id=\"undoBtn\" class=\"tool-btn\">‚Ü∂ Deshacer</button>\n                    <button id=\"redoBtn\" class=\"tool-btn\">‚Ü∑ Rehacer</button>\n                    <button id=\"deleteSelected\" class=\"tool-btn\">üóëÔ∏è Eliminar Seleccionado</button>\n                </div>\n            </aside>\n\n            <!-- Canvas Area -->\n            <main class=\"canvas-area\">\n                <canvas id=\"mapCanvas\"></canvas>\n                <div class=\"canvas-info\">\n                    <span id=\"coordinates\">X: 0, Y: 0</span>\n                    <span id=\"tool-status\">Herramienta: Seleccionar</span>\n                </div>\n            </main>\n        </div>\n\n        <!-- Hidden file input for loading -->\n        <input type=\"file\" id=\"fileInput\" accept=\".json\" style=\"display:none;\">\n    </div>\n\n    <script src=\"app.js\"></script>\n</body>\n</html>",
        "type": "file",
        "timestamp": "2026-02-10T16:13:48.900Z",
        "isStreaming": false,
        "isUserEdited": false
      }
    ],
    "styles.css": [
      {
        "version": 1,
        "messageId": "99453f48-16d4-49a9-882b-58c9c34e6a84",
        "id": "file:styles.css#2.141",
        "language": "css",
        "name": "styles.css",
        "value": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n    padding: 20px;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\nheader {\n    background: white;\n    padding: 20px;\n    border-radius: 8px;\n    margin-bottom: 20px;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n    text-align: center;\n}\n\nheader h1 {\n    color: #333;\n    font-size: 2.5em;\n    margin-bottom: 5px;\n}\n\nheader p {\n    color: #666;\n    font-size: 1em;\n}\n\n.workspace {\n    display: flex;\n    gap: 20px;\n    height: calc(100vh - 300px);\n    background: white;\n    border-radius: 8px;\n    overflow: hidden;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n}\n\n.control-panel {\n    width: 280px;\n    background: #f8f9fa;\n    padding: 20px;\n    overflow-y: auto;\n    border-right: 1px solid #ddd;\n}\n\n.control-panel::-webkit-scrollbar {\n    width: 8px;\n}\n\n.control-panel::-webkit-scrollbar-track {\n    background: #f1f1f1;\n}\n\n.control-panel::-webkit-scrollbar-thumb {\n    background: #888;\n    border-radius: 4px;\n}\n\n.control-panel::-webkit-scrollbar-thumb:hover {\n    background: #555;\n}\n\n.panel-section {\n    margin-bottom: 25px;\n    padding-bottom: 15px;\n    border-bottom: 1px solid #ddd;\n}\n\n.panel-section h3 {\n    font-size: 1em;\n    color: #333;\n    margin-bottom: 12px;\n    font-weight: 600;\n}\n\n.panel-section label {\n    display: block;\n    margin-bottom: 10px;\n    font-size: 0.9em;\n    color: #555;\n}\n\n.panel-section input[type=\"text\"],\n.panel-section input[type=\"number\"],\n.panel-section input[type=\"color\"] {\n    width: 100%;\n    padding: 8px;\n    margin-top: 4px;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    font-size: 0.9em;\n}\n\n.panel-section input[type=\"color\"] {\n    padding: 4px;\n    height: 40px;\n    cursor: pointer;\n}\n\n.tool-group {\n    margin-bottom: 12px;\n}\n\n.btn {\n    width: 100%;\n    padding: 10px;\n    margin-bottom: 8px;\n    border: none;\n    border-radius: 4px;\n    font-size: 0.9em;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    font-weight: 500;\n    background: #e9ecef;\n    color: #333;\n}\n\n.btn:hover {\n    background: #dee2e6;\n    transform: translateY(-2px);\n    box-shadow: 0 2px 6px rgba(0,0,0,0.1);\n}\n\n.btn-primary {\n    background: #667eea;\n    color: white;\n}\n\n.btn-primary:hover {\n    background: #5568d3;\n}\n\n.btn-success {\n    background: #48bb78;\n    color: white;\n}\n\n.btn-success:hover {\n    background: #38a169;\n}\n\n.btn-info {\n    background: #4299e1;\n    color: white;\n}\n\n.btn-info:hover {\n    background: #3182ce;\n}\n\n.btn-danger {\n    background: #f56565;\n    color: white;\n}\n\n.btn-danger:hover {\n    background: #e53e3e;\n}\n\n.tool-btn {\n    width: 100%;\n    padding: 8px;\n    margin-bottom: 6px;\n    border: 2px solid #ddd;\n    border-radius: 4px;\n    background: white;\n    color: #333;\n    cursor: pointer;\n    font-size: 0.85em;\n    transition: all 0.2s ease;\n}\n\n.tool-btn:hover {\n    border-color: #667eea;\n    background: #f0f4ff;\n}\n\n.tool-btn.active {\n    border-color: #667eea;\n    background: #667eea;\n    color: white;\n}\n\n.canvas-area {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    position: relative;\n    overflow: hidden;\n}\n\n#mapCanvas {\n    flex: 1;\n    cursor: crosshair;\n    background: white;\n    border: 2px solid #e0e0e0;\n    display: block;\n}\n\n.canvas-info {\n    padding: 10px 20px;\n    background: #f8f9fa;\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.9em;\n    color: #666;\n    border-top: 1px solid #ddd;\n}\n\n/* Responsive Design */\n@media (max-width: 1024px) {\n    .workspace {\n        flex-direction: column;\n        height: auto;\n    }\n\n    .control-panel {\n        width: 100%;\n        max-height: 300px;\n        border-right: none;\n        border-bottom: 1px solid #ddd;\n    }\n}\n\n/* Animations */\n@keyframes pulse {\n    0%, 100% {\n        opacity: 1;\n    }\n    50% {\n        opacity: 0.7;\n    }\n}\n\n.tool-btn.active {\n    animation: pulse 0.5s ease-in-out;\n}",
        "type": "file",
        "timestamp": "2026-02-10T16:13:48.900Z",
        "isStreaming": false,
        "isUserEdited": false
      }
    ],
    "app.py": [
      {
        "version": 1,
        "messageId": "d019da48-dbc8-4c2f-a087-e79cd53cd013",
        "id": "file:app.py#2.5",
        "language": "python",
        "name": "app.py",
        "value": "from flask import Flask, render_template, request, jsonify, send_file\nfrom PIL import Image, ImageDraw\nimport io\nimport os\nfrom datetime import datetime\n\napp = Flask(__name__)\n\n# Configuration\nUPLOAD_FOLDER = 'maps'\nif not os.path.exists(UPLOAD_FOLDER):\n    os.makedirs(UPLOAD_FOLDER)\n\n# Map templates (preset regions)\nMAP_TEMPLATES = {\n    'south_america': {\n        'name': 'South America',\n        'width': 800,\n        'height': 900,\n        'bounds': {'north': 12, 'south': -56, 'west': -82, 'east': -34}\n    },\n    'europe': {\n        'name': 'Europe',\n        'width': 900,\n        'height': 700,\n        'bounds': {'north': 71, 'south': 35, 'west': -10, 'east': 40}\n    },\n    'africa': {\n        'name': 'Africa',\n        'width': 700,\n        'height': 850,\n        'bounds': {'north': 37, 'south': -35, 'west': -18, 'east': 52}\n    },\n    'asia': {\n        'name': 'Asia',\n        'width': 1000,\n        'height': 700,\n        'bounds': {'north': 77, 'south': -10, 'west': 26, 'east': 150}\n    },\n    'north_america': {\n        'name': 'North America',\n        'width': 800,\n        'height': 700,\n        'bounds': {'north': 83, 'south': 15, 'west': -170, 'east': -52}\n    }\n}\n\nclass PhysicalMap:\n    def __init__(self, template_name='south_america', title='Physical Map'):\n        self.template = MAP_TEMPLATES.get(template_name, MAP_TEMPLATES['south_america'])\n        self.width = self.template['width']\n        self.height = self.template['height']\n        self.title = title\n        \n        # Create base image with light blue background (ocean)\n        self.image = Image.new('RGB', (self.width, self.height), color='#E8F4F8')\n        self.draw = ImageDraw.Draw(self.image, 'RGBA')\n        \n        # Add title\n        self._draw_title()\n        \n        # Features to be drawn\n        self.features = []\n    \n    def _draw_title(self):\n        \"\"\"Draw title at the top of the map\"\"\"\n        title_y = 10\n        # Using default font; for better results, you can load a custom font\n        self.draw.text((self.width//2 - 100, title_y), self.title, fill='#000000')\n    \n    def add_mountain_range(self, name, points, color='#8B7355'):\n        \"\"\"Add a mountain range using brown/tan colors\"\"\"\n        if len(points) > 1:\n            # Draw triangular mountain peaks\n            for i in range(0, len(points) - 1, 2):\n                x1, y1 = points[i]\n                x2, y2 = points[i + 1] if i + 1 < len(points) else points[i]\n                peak_x = (x1 + x2) / 2\n                peak_y = min(y1, y2) - 20\n                triangle = [(x1, y1), (peak_x, peak_y), (x2, y2)]\n                self.draw.polygon(triangle, fill=color, outline='#654321')\n        \n        self.features.append({'type': 'mountain', 'name': name, 'color': color})\n    \n    def add_river(self, name, points, color='#4A90E2', width=3):\n        \"\"\"Add a river as a line\"\"\"\n        if len(points) > 1:\n            for i in range(len(points) - 1):\n                self.draw.line([points[i], points[i+1]], fill=color, width=width)\n        \n        self.features.append({'type': 'river', 'name': name, 'color': color})\n    \n    def add_lake(self, name, center, radius=15, color='#4A90E2'):\n        \"\"\"Add a lake as a circle\"\"\"\n        x, y = center\n        bbox = [x - radius, y - radius, x + radius, y + radius]\n        self.draw.ellipse(bbox, fill=color, outline='#2E5C8A')\n        \n        self.features.append({'type': 'lake', 'name': name, 'color': color})\n    \n    def add_forest(self, name, points, color='#2D5016'):\n        \"\"\"Add forest areas using green\"\"\"\n        if len(points) >= 3:\n            self.draw.polygon(points, fill=color, outline='#1a3d0a')\n        \n        self.features.append({'type': 'forest', 'name': name, 'color': color})\n    \n    def add_desert(self, name, points, color='#F4D03F'):\n        \"\"\"Add desert areas using yellow/tan\"\"\"\n        if len(points) >= 3:\n            self.draw.polygon(points, fill=color, outline='#D4A017')\n        \n        self.features.append({'type': 'desert', 'name': name, 'color': color})\n    \n    def add_city(self, name, position, size=5, color='#FF0000'):\n        \"\"\"Add a city marker\"\"\"\n        x, y = position\n        bbox = [x - size, y - size, x + size, y + size]\n        self.draw.ellipse(bbox, fill=color, outline='#8B0000')\n        \n        # Add city label\n        self.draw.text((x + 8, y - 8), name, fill='#000000')\n        \n        self.features.append({'type': 'city', 'name': name, 'color': color})\n    \n    def add_coastline(self, name, points, color='#000000', width=2):\n        \"\"\"Add a coastline or border\"\"\"\n        if len(points) > 1:\n            self.draw.line(points, fill=color, width=width)\n        \n        self.features.append({'type': 'coastline', 'name': name})\n    \n    def add_legend(self):\n        \"\"\"Add a legend to the map\"\"\"\n        legend_x = self.width - 200\n        legend_y = 50\n        box_height = len(self.features) * 25 + 20\n        \n        # Draw legend box\n        self.draw.rectangle(\n            [legend_x - 10, legend_y - 10, self.width - 10, legend_y + box_height],\n            fill='#FFFFFF',\n            outline='#000000'\n        )\n        \n        # Draw legend entries\n        self.draw.text((legend_x, legend_y), 'Legend', fill='#000000')\n        for idx, feature in enumerate(self.features):\n            y = legend_y + 25 + (idx * 20)\n            # Draw color box\n            self.draw.rectangle(\n                [legend_x, y, legend_x + 15, y + 15],\n                fill=feature.get('color', '#CCCCCC'),\n                outline='#000000'\n            )\n            # Draw label\n            self.draw.text((legend_x + 20, y), feature['name'][:20], fill='#000000')\n    \n    def save(self, filename=None):\n        \"\"\"Save the map to a file\"\"\"\n        if filename is None:\n            timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')\n            filename = f\"map_{timestamp}.png\"\n        \n        filepath = os.path.join(UPLOAD_FOLDER, filename)\n        self.image.save(filepath)\n        return filepath\n\n# Flask Routes\n@app.route('/')\ndef index():\n    \"\"\"Main page\"\"\"\n    return render_template('index.html', templates=MAP_TEMPLATES)\n\n@app.route('/api/create-map', methods=['POST'])\ndef create_map():\n    \"\"\"Create a new map with features\"\"\"\n    data = request.json\n    template = data.get('template', 'south_america')\n    title = data.get('title', 'Physical Map')\n    \n    # Create map\n    map_obj = PhysicalMap(template, title)\n    \n    # Add features from request\n    features = data.get('features', [])\n    for feature in features:\n        feature_type = feature.get('type')\n        \n        if feature_type == 'mountain':\n            map_obj.add_mountain_range(feature['name'], feature['points'], feature.get('color', '#8B7355'))\n        elif feature_type == 'river':\n            map_obj.add_river(feature['name'], feature['points'], feature.get('color', '#4A90E2'))\n        elif feature_type == 'lake':\n            map_obj.add_lake(feature['name'], tuple(feature['center']), feature.get('radius', 15), feature.get('color', '#4A90E2'))\n        elif feature_type == 'forest':\n            map_obj.add_forest(feature['name'], feature['points'], feature.get('color', '#2D5016'))\n        elif feature_type == 'desert':\n            map_obj.add_desert(feature['name'], feature['points'], feature.get('color', '#F4D03F'))\n        elif feature_type == 'city':\n            map_obj.add_city(feature['name'], tuple(feature['position']), feature.get('size', 5), feature.get('color', '#FF0000'))\n    \n    # Add legend\n    map_obj.add_legend()\n    \n    # Save map\n    filename = f\"map_{datetime.now().strftime('%Y%m%d_%H%M%S')}.png\"\n    filepath = map_obj.save(filename)\n    \n    return jsonify({\n        'success': True,\n        'filename': filename,\n        'url': f'/api/download-map/{filename}'\n    })\n\n@app.route('/api/download-map/<filename>')\ndef download_map(filename):\n    \"\"\"Download a created map\"\"\"\n    filepath = os.path.join(UPLOAD_FOLDER, filename)\n    if os.path.exists(filepath):\n        return send_file(filepath, mimetype='image/png', as_attachment=True)\n    return jsonify({'error': 'Map not found'}), 404\n\n@app.route('/api/preview-map', methods=['POST'])\ndef preview_map():\n    \"\"\"Preview a map before saving\"\"\"\n    data = request.json\n    template = data.get('template', 'south_america')\n    title = data.get('title', 'Physical Map')\n    \n    map_obj = PhysicalMap(template, title)\n    \n    features = data.get('features', [])\n    for feature in features:\n        feature_type = feature.get('type')\n        \n        if feature_type == 'mountain':\n            map_obj.add_mountain_range(feature['name'], feature['points'], feature.get('color', '#8B7355'))\n        elif feature_type == 'river':\n            map_obj.add_river(feature['name'], feature['points'], feature.get('color', '#4A90E2'))\n        elif feature_type == 'lake':\n            map_obj.add_lake(feature['name'], tuple(feature['center']), feature.get('radius', 15), feature.get('color', '#4A90E2'))\n        elif feature_type == 'forest':\n            map_obj.add_forest(feature['name'], feature['points'], feature.get('color', '#2D5016'))\n        elif feature_type == 'desert':\n            map_obj.add_desert(feature['name'], feature['points'], feature.get('color', '#F4D03F'))\n        elif feature_type == 'city':\n            map_obj.add_city(feature['name'], tuple(feature['position']), feature.get('size', 5), feature.get('color', '#FF0000'))\n    \n    map_obj.add_legend()\n    \n    # Save to bytes and return as base64\n    img_io = io.BytesIO()\n    map_obj.image.save(img_io, 'PNG')\n    img_io.seek(0)\n    \n    import base64\n    img_base64 = base64.b64encode(img_io.getvalue()).decode()\n    \n    return jsonify({\n        'success': True,\n        'image': f'data:image/png;base64,{img_base64}'\n    })\n\nif __name__ == '__main__':\n    app.run(debug=True, port=5000)",
        "type": "file",
        "timestamp": "2026-02-10T16:17:30.565Z",
        "isStreaming": false,
        "isUserEdited": false
      }
    ],
    "templates/index.html": [
      {
        "version": 1,
        "messageId": "d019da48-dbc8-4c2f-a087-e79cd53cd013",
        "id": "file:templates/index.html#2.274",
        "language": "html",
        "name": "templates/index.html",
        "value": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>MAPAS F√çSICOS - Physical Map Creator</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            min-height: 100vh;\n            padding: 20px;\n        }\n        \n        .container {\n            max-width: 1400px;\n            margin: 0 auto;\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 20px;\n        }\n        \n        @media (max-width: 1024px) {\n            .container {\n                grid-template-columns: 1fr;\n            }\n        }\n        \n        .card {\n            background: white;\n            border-radius: 10px;\n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);\n            padding: 30px;\n            overflow-y: auto;\n            max-height: 90vh;\n        }\n        \n        h1 {\n            color: #333;\n            margin-bottom: 30px;\n            text-align: center;\n            grid-column: 1 / -1;\n            color: white;\n        }\n        \n        h2 {\n            color: #667eea;\n            margin-bottom: 20px;\n            font-size: 1.5em;\n        }\n        \n        .form-group {\n            margin-bottom: 20px;\n        }\n        \n        label {\n            display: block;\n            margin-bottom: 8px;\n            color: #333;\n            font-weight: 500;\n        }\n        \n        input[type=\"text\"],\n        input[type=\"number\"],\n        select {\n            width: 100%;\n            padding: 10px;\n            border: 2px solid #ddd;\n            border-radius: 5px;\n            font-size: 1em;\n            transition: border-color 0.3s;\n        }\n        \n        input[type=\"text\"]:focus,\n        input[type=\"number\"]:focus,\n        select:focus {\n            outline: none;\n            border-color: #667eea;\n        }\n        \n        input[type=\"color\"] {\n            width: 100%;\n            height: 40px;\n            border: 2px solid #ddd;\n            border-radius: 5px;\n            cursor: pointer;\n        }\n        \n        button {\n            background: #667eea;\n            color: white;\n            padding: 12px 20px;\n            border: none;\n            border-radius: 5px;\n            font-size: 1em;\n            cursor: pointer;\n            transition: background 0.3s;\n            width: 100%;\n            margin-top: 10px;\n        }\n        \n        button:hover {\n            background: #5568d3;\n        }\n        \n        button.secondary {\n            background: #e74c3c;\n        }\n        \n        button.secondary:hover {\n            background: #c0392b;\n        }\n        \n        button.success {\n            background: #27ae60;\n        }\n        \n        button.success:hover {\n            background: #229954;\n        }\n        \n        .feature-item {\n            background: #f5f5f5;\n            padding: 15px;\n            border-radius: 5px;\n            margin-bottom: 15px;\n            border-left: 4px solid #667eea;\n            position: relative;\n        }\n        \n        .feature-item h4 {\n            margin-bottom: 8px;\n            color: #333;\n        }\n        \n        .feature-item p {\n            font-size: 0.9em;\n            color: #666;\n            margin-bottom: 5px;\n        }\n        \n        .remove-btn {\n            position: absolute;\n            top: 10px;\n            right: 10px;\n            background: #e74c3c;\n            color: white;\n            border: none;\n            padding: 5px 10px;\n            border-radius: 3px;\n            cursor: pointer;\n            font-size: 0.9em;\n        }\n        \n        .remove-btn:hover {\n            background: #c0392b;\n        }\n        \n        .preview {\n            border: 2px solid #ddd;\n            border-radius: 5px;\n            padding: 10px;\n            text-align: center;\n            background: #f9f9f9;\n            margin-top: 15px;\n        }\n        \n        .preview img {\n            max-width: 100%;\n            max-height: 400px;\n            border-radius: 5px;\n        }\n        \n        .color-picker-group {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 10px;\n        }\n        \n        .coordinates-group {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 10px;\n        }\n        \n        .feature-type-selector {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 10px;\n            margin-bottom: 20px;\n        }\n        \n        .feature-type-btn {\n            padding: 10px;\n            background: #ecf0f1;\n            border: 2px solid transparent;\n            border-radius: 5px;\n            cursor: pointer;\n            transition: all 0.3s;\n        }\n        \n        .feature-type-btn:hover {\n            border-color: #667eea;\n        }\n        \n        .feature-type-btn.active {\n            background: #667eea;\n            color: white;\n        }\n        \n        .loading {\n            display: none;\n            text-align: center;\n            color: #667eea;\n            margin-top: 20px;\n        }\n        \n        .spinner {\n            border: 4px solid #f3f3f3;\n            border-top: 4px solid #667eea;\n            border-radius: 50%;\n            width: 40px;\n            height: 40px;\n            animation: spin 1s linear infinite;\n            margin: 0 auto 10px;\n        }\n        \n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n        \n        .success-message {\n            background: #d4edda;\n            border: 1px solid #c3e6cb;\n            color: #155724;\n            padding: 15px;\n            border-radius: 5px;\n            margin-bottom: 15px;\n            display: none;\n        }\n        \n        .success-message a {\n            color: #155724;\n            font-weight: bold;\n        }\n    </style>\n</head>\n<body>\n    <h1>üó∫Ô∏è MAPAS F√çSICOS - Physical Map Creator</h1>\n    \n    <div class=\"container\">\n        <!-- LEFT PANEL: MAP CONFIGURATION -->\n        <div class=\"card\">\n            <h2>Map Configuration</h2>\n            \n            <div class=\"form-group\">\n                <label for=\"mapTitle\">Map Title:</label>\n                <input type=\"text\" id=\"mapTitle\" placeholder=\"e.g., South America Physical Map\" value=\"Physical Map\">\n            </div>\n            \n            <div class=\"form-group\">\n                <label for=\"mapTemplate\">Select Region:</label>\n                <select id=\"mapTemplate\">\n                    <option value=\"south_america\">South America</option>\n                    <option value=\"europe\">Europe</option>\n                    <option value=\"africa\">Africa</option>\n                    <option value=\"asia\">Asia</option>\n                    <option value=\"north_america\">North America</option>\n                </select>\n            </div>\n            \n            <h2 style=\"margin-top: 30px;\">Add Features</h2>\n            \n            <div class=\"feature-type-selector\">\n                <button class=\"feature-type-btn active\" data-type=\"city\">üèôÔ∏è City</button>\n                <button class=\"feature-type-btn\" data-type=\"mountain\">‚õ∞Ô∏è Mountain</button>\n                <button class=\"feature-type-btn\" data-type=\"river\">üíß River</button>\n                <button class=\"feature-type-btn\" data-type=\"lake\">üèûÔ∏è Lake</button>\n                <button class=\"feature-type-btn\" data-type=\"forest\">üå≤ Forest</button>\n                <button class=\"feature-type-btn\" data-type=\"desert\">üèúÔ∏è Desert</button>\n            </div>\n            \n            <!-- Dynamic form fields based on feature type -->\n            <div id=\"featureForm\"></div>\n            \n            <button class=\"success\" id=\"addFeatureBtn\">+ Add Feature</button>\n            \n            <h2 style=\"margin-top: 30px;\">Features Added</h2>\n            <div id=\"featuresList\"></div>\n            \n            <button id=\"previewBtn\" style=\"margin-top: 20px;\">üëÅÔ∏è Preview Map</button>\n            <button id=\"downloadBtn\" class=\"success\" style=\"margin-top: 10px;\">üì• Download Map</button>\n        </div>\n        \n        <!-- RIGHT PANEL: MAP PREVIEW -->\n        <div class=\"card\">\n            <h2>Map Preview</h2>\n            \n            <div class=\"success-message\" id=\"successMessage\">\n                Map created successfully! <a href=\"#\" id=\"downloadLink\">Download it here</a>\n            </div>\n            \n            <div class=\"preview\" id=\"preview\">\n                <p style=\"color: #999; padding: 40px;\">Preview will appear here</p>\n            </div>\n            \n            <div class=\"loading\" id=\"loading\">\n                <div class=\"spinner\"></div>\n                <p>Creating your map...</p>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        let currentFeatureType = 'city';\n        let features = [];\n        \n        const featureConfigs = {\n            city: {\n                name: 'City',\n                fields: [\n                    { name: 'featureName', label: 'City Name', type: 'text', placeholder: 'e.g., S√£o Paulo' },\n                    { name: 'posX', label: 'X Position (0-800)', type: 'number', min: 0, max: 800, value: 100 },\n                    { name: 'posY', label: 'Y Position (0-900)', type: 'number', min: 0, max: 900, value: 100 },\n                    { name: 'color', label: 'Color', type: 'color', value: '#FF0000' }\n                ]\n            },\n            mountain: {\n                name: 'Mountain Range',\n                fields: [\n                    { name: 'featureName', label: 'Mountain Name', type: 'text', placeholder: 'e.g., Andes' },\n                    { name: 'color', label: 'Color', type: 'color', value: '#8B7355' }\n                ],\n                helper: 'Enter coordinates as comma-separated pairs (x1,y1 x2,y2 x3,y3...)'\n            },\n            river: {\n                name: 'River',\n                fields: [\n                    { name: 'featureName', label: 'River Name', type: 'text', placeholder: 'e.g., Amazon' },\n                    { name: 'color', label: 'Color', type: 'color', value: '#4A90E2' }\n                ],\n                helper: 'Enter coordinates as comma-separated pairs (x1,y1 x2,y2 x3,y3...)'\n            },\n            lake: {\n                name: 'Lake',\n                fields: [\n                    { name: 'featureName', label: 'Lake Name', type: 'text', placeholder: 'e.g., Lake Titicaca' },\n                    { name: 'centerX', label: 'Center X (0-800)', type: 'number', min: 0, max: 800, value: 100 },\n                    { name: 'centerY', label: 'Center Y (0-900)', type: 'number', min: 0, max: 900, value: 100 },\n                    { name: 'radius', label: 'Radius', type: 'number', min: 5, max: 100, value: 20 },\n                    { name: 'color', label: 'Color', type: 'color', value: '#4A90E2' }\n                ]\n            },\n            forest: {\n                name: 'Forest',\n                fields: [\n                    { name: 'featureName', label: 'Forest Name', type: 'text', placeholder: 'e.g., Amazon Rainforest' },\n                    { name: 'color', label: 'Color', type: 'color', value: '#2D5016' }\n                ],\n                helper: 'Enter coordinates as comma-separated pairs (x1,y1 x2,y2 x3,y3...)'\n            },\n            desert: {\n                name: 'Desert',\n                fields: [\n                    { name: 'featureName', label: 'Desert Name', type: 'text', placeholder: 'e.g., Atacama Desert' },\n                    { name: 'color', label: 'Color', type: 'color', value: '#F4D03F' }\n                ],\n                helper: 'Enter coordinates as comma-separated pairs (x1,y1 x2,y2 x3,y3...)'\n            }\n        };\n        \n        // Feature type selector\n        document.querySelectorAll('.feature-type-btn').forEach(btn => {\n            btn.addEventListener('click', () => {\n                document.querySelectorAll('.feature-type-btn').forEach(b => b.classList.remove('active'));\n                btn.classList.add('active');\n                currentFeatureType = btn.dataset.type;\n                renderFeatureForm();\n            });\n        });\n        \n        function renderFeatureForm() {\n            const config = featureConfigs[currentFeatureType];\n            let html = '';\n            \n            if (config.helper) {\n                html += `<div class=\"form-group\" style=\"background: #e8f4f8; padding: 10px; border-radius: 5px; margin-bottom: 15px;\">\n                    <small>${config.helper}</small>\n                </div>`;\n            }\n            \n            config.fields.forEach(field => {\n                if (field.type === 'color') {\n                    html += `<div class=\"form-group\">\n                        <label for=\"${field.name}\">${field.label}</label>\n                        <input type=\"${field.type}\" id=\"${field.name}\" value=\"${field.value}\">\n                    </div>`;\n                } else {\n                    html += `<div class=\"form-group\">\n                        <label for=\"${field.name}\">${field.label}</label>\n                        <input type=\"${field.type}\" id=\"${field.name}\" placeholder=\"${field.placeholder || ''}\" \n                               value=\"${field.value || ''}\" ${field.min ? `min=\"${field.min}\"` : ''} ${field.max ? `max=\"${field.max}\"` : ''}>\n                    </div>`;\n                }\n            });\n            \n            // Add coordinates input for path-based features\n            if (['mountain', 'river', 'forest', 'desert'].includes(currentFeatureType)) {\n                html += `<div class=\"form-group\">\n                    <label for=\"coordinates\">Coordinates:</label>\n                    <textarea id=\"coordinates\" placeholder=\"x1,y1 x2,y2 x3,y3\" style=\"width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-family: monospace;\" rows=\"4\"></textarea>\n                </div>`;\n            }\n            \n            document.getElementById('featureForm').innerHTML = html;\n        }\n        \n        renderFeatureForm();\n        \n        function getFeatureData() {\n            const config = featureConfigs[currentFeatureType];\n            const data = { type: currentFeatureType };\n            \n            config.fields.forEach(field => {\n                const element = document.getElementById(field.name);\n                if (element) {\n                    data[field.name] = element.value;\n                }\n            });\n            \n            // Parse coordinates for path-based features\n            if (['mountain', 'river', 'forest', 'desert'].includes(currentFeatureType)) {\n                const coordsText = document.getElementById('coordinates').value;\n                const points = coordsText.split(' ').map(pair => {\n                    const [x, y] = pair.split(',').map(v => parseInt(v.trim()));\n                    return [x, y];\n                }).filter(p => !isNaN(p[0]) && !isNaN(p[1]));\n                \n                if (points.length < 2) {\n                    alert('Please enter at least 2 coordinate pairs');\n                    return null;\n                }\n                data.points = points;\n            }\n            \n            return data;\n        }\n        \n        document.getElementById('addFeatureBtn').addEventListener('click', () => {\n            const data = getFeatureData();\n            if (!data) return;\n            \n            if (!data.featureName || data.featureName.trim() === '') {\n                alert('Please enter a feature name');\n                return;\n            }\n            \n            let featureObj = {\n                type: data.type,\n                name: data.featureName,\n                color: data.color || '#000000'\n            };\n            \n            if (data.type === 'city') {\n                featureObj.position = [parseInt(data.posX), parseInt(data.posY)];\n            } else if (data.type === 'lake') {\n                featureObj.center = [parseInt(data.centerX), parseInt(data.centerY)];\n                featureObj.radius = parseInt(data.radius) || 20;\n            } else if (['mountain', 'river', 'forest', 'desert'].includes(data.type)) {\n                featureObj.points = data.points;\n            }\n            \n            features.push(featureObj);\n            renderFeaturesList();\n            document.getElementById('coordinates').value = '';\n            config.fields.forEach(field => {\n                const element = document.getElementById(field.name);\n                if (element) element.value = field.value || '';\n            });\n        });\n        \n        function renderFeaturesList() {\n            const html = features.map((feature, index) => `\n                <div class=\"feature-item\">\n                    <h4>${feature.name} (${feature.type})</h4>\n                    <p style=\"display: inline-block; width: 15px; height: 15px; background: ${feature.color}; border-radius: 3px; vertical-align: middle;\"></p>\n                    <button class=\"remove-btn\" onclick=\"removeFeature(${index})\">Remove</button>\n                </div>\n            `).join('');\n            \n            document.getElementById('featuresList').innerHTML = html || '<p style=\"color: #999;\">No features added yet</p>';\n        }\n        \n        window.removeFeature = (index) => {\n            features.splice(index, 1);\n            renderFeaturesList();\n        };\n        \n        document.getElementById('previewBtn').addEventListener('click', async () => {\n            const loading = document.getElementById('loading');\n            loading.style.display = 'block';\n            \n            try {\n                const response = await fetch('/api/preview-map', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        template: document.getElementById('mapTemplate').value,\n                        title: document.getElementById('mapTitle').value,\n                        features: features\n                    })\n                });\n                \n                const data = await response.json();\n                if (data.success) {\n                    document.getElementById('preview').innerHTML = `<img src=\"${data.image}\" alt=\"Map Preview\">`;\n                }\n            } catch (error) {\n                console.error('Error:', error);\n                alert('Error generating preview');\n            } finally {\n                loading.style.display = 'none';\n            }\n        });\n        \n        document.getElementById('downloadBtn').addEventListener('click', async () => {\n            const loading = document.getElementById('loading');\n            loading.style.display = 'block';\n            \n            try {\n                const response = await fetch('/api/create-map', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        template: document.getElementById('mapTemplate').value,\n                        title: document.getElementById('mapTitle').value,\n                        features: features\n                    })\n                });\n                \n                const data = await response.json();\n                if (data.success) {\n                    document.getElementById('preview').innerHTML = `<img src=\"/api/download-map/${data.filename}?t=${Date.now()}\" alt=\"Map\">`;\n                    document.getElementById('downloadLink').href = data.url;\n                    document.getElementById('successMessage').style.display = 'block';\n                    setTimeout(() => {\n                        document.getElementById('successMessage').style.display = 'none';\n                    }, 5000);\n                }\n            } catch (error) {\n                console.error('Error:', error);\n                alert('Error creating map');\n            } finally {\n                loading.style.display = 'none';\n            }\n        });\n    </script>\n</body>\n</html>",
        "type": "file",
        "timestamp": "2026-02-10T16:17:30.565Z",
        "isStreaming": false,
        "isUserEdited": false
      }
    ],
    "requirements.txt": [
      {
        "version": 1,
        "messageId": "d019da48-dbc8-4c2f-a087-e79cd53cd013",
        "id": "file:requirements.txt#2.843",
        "language": "txt",
        "name": "requirements.txt",
        "value": "Flask==2.3.3\nPillow==10.0.0\nWerkzeug==2.3.7",
        "type": "file",
        "timestamp": "2026-02-10T16:17:30.565Z",
        "isStreaming": false,
        "isUserEdited": false
      }
    ],
    "README.md": [
      {
        "version": 1,
        "messageId": "d019da48-dbc8-4c2f-a087-e79cd53cd013",
        "id": "file:README.md#2.849",
        "language": "markdown",
        "name": "README.md",
        "value": "# üó∫Ô∏è MAPAS F√çSICOS - Physical Map Creator\n\nAn interactive web application for creating educational physical maps with customizable geographical features. Perfect for high school geography students and teachers.\n\n## Features\n\n- **Multiple Map Templates**: Pre-configured regions (South America, Europe, Africa, Asia, North America)\n- **Geographical Features**: Add mountains, rivers, lakes, forests, deserts, cities, and coastlines\n- **Customizable Styling**: Choose colors for each feature\n- **Real-time Preview**: See your map as you build it\n- **Legend Generation**: Automatic legend creation\n- **Easy Download**: Export maps as PNG images\n\n## Installation\n\n1. **Clone the repository**:\n   ```bash\n   git clone https://github.com/alvarofrink/MAPAS-FISICOS.git\n   cd MAPAS-FISICOS",
        "type": "file",
        "timestamp": "2026-02-10T16:17:30.565Z",
        "isStreaming": false,
        "isUserEdited": false
      }
    ]
  }
}